<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Recipe Journal</title>
    <link rel="stylesheet" href="css/styles.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div id="branding">
                <h1 data-i18n="my_recipe_journal">My Recipe Journal</h1>
            </div>
            <div class="search-container">
                <input type="text" id="search-bar" placeholder="Search recipes..." data-i18n="search_placeholder">
            </div>
        </div>
        <!-- Language Switcher - Outside the main content flow -->
        <div class="language-switcher">
            <button class="language-toggle" id="language-toggle">
                <span class="current-lang">English</span>
                <span class="toggle-icon">üåç</span>
            </button>
            <div class="language-menu" id="language-menu">
                <!-- Language options will be loaded dynamically -->
            </div>
        </div>
    </header>
    <div class="main-content">
        <!-- Recipes will be loaded dynamically from data/recipes.json -->
    </div>
    
    <!-- Inline debugging script -->
    <script>
        console.log('=== INLINE DEBUGGING ===');
        console.log('DOM ready state:', document.readyState);
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DOM CONTENT LOADED ===');
            
            const toggle = document.getElementById('language-toggle');
            const menu = document.getElementById('language-menu');
            
            console.log('Toggle element:', toggle);
            console.log('Menu element:', menu);
            
            if (toggle && menu) {
                console.log('Elements found, adding basic click test...');
                
                // Add a simple click test
                toggle.addEventListener('click', function(e) {
                    console.log('=== BASIC CLICK TEST ===');
                    console.log('Button clicked!');
                    console.log('Event:', e);
                    console.log('Target:', e.target);
                    
                    // Simple toggle test
                    const isVisible = menu.classList.contains('show');
                    console.log('Menu visible before:', isVisible);
                    
                    menu.classList.toggle('show');
                    
                    const isVisibleAfter = menu.classList.contains('show');
                    console.log('Menu visible after:', isVisibleAfter);
                    
                    // Remove debugging code that sets red background
                    if (isVisibleAfter) {
                        console.log('Menu shown');
                    } else {
                        console.log('Menu hidden');
                    }
                });
                
                console.log('Basic click test added successfully');
                
                // Debug language options
                const langOptions = menu.querySelectorAll('.lang-option');
                console.log('Found language options:', langOptions.length);
                langOptions.forEach((option, index) => {
                    console.log(`Language option ${index}:`, option);
                    console.log(`- text:`, option.textContent);
                    console.log(`- data-lang:`, option.dataset.lang);
                    
                    // Add click debugging
                    option.addEventListener('click', function(e) {
                        console.log('=== LANGUAGE OPTION CLICKED ===');
                        console.log('Option clicked:', this.textContent);
                        console.log('Language code:', this.dataset.lang);
                        console.log('Event:', e);
                        
                        // Update active state
                        langOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update display
                        const currentLangSpan = document.querySelector('.current-lang');
                        if (currentLangSpan) {
                            currentLangSpan.textContent = this.textContent;
                        }
                        
                        // Close menu
                        menu.classList.remove('show');
                        
                        console.log('Language changed to:', this.dataset.lang);
                        
                        // Try to call dynamic translator
                        console.log('Checking for dynamic translator...');
                        console.log('window.dynamicTranslator:', window.dynamicTranslator);
                        
                        if (window.dynamicTranslator) {
                            console.log('Dynamic translator found, calling changeLanguage...');
                            try {
                                window.dynamicTranslator.changeLanguage(this.dataset.lang);
                                console.log('Dynamic translator changeLanguage called successfully');
                            } catch (error) {
                                console.error('Error calling dynamic translator:', error);
                            }
                        } else {
                            console.log('Dynamic translator not available');
                        }
                        
                        // Save to localStorage
                        localStorage.setItem('cookbook-language', this.dataset.lang);
                        console.log('Language preference saved to localStorage');
                    });
                });
                
                console.log('Language option click listeners added');
            } else {
                console.error('Language switcher elements not found!');
                console.log('Toggle:', toggle);
                console.log('Menu:', menu);
            }
        });
    </script>
    
    <script src="js/scalableTranslator.min.js"></script>
    <script>
        console.log('=== SCALABLE TRANSLATOR CHECK ===');
        console.log('After loading scalableTranslator.min.js');
        console.log('window.scalableTranslator:', window.scalableTranslator);
        
        // Check for any JavaScript errors
        window.addEventListener('error', function(e) {
            console.error('JavaScript error:', e.error);
            console.error('Error message:', e.message);
            console.error('Error filename:', e.filename);
            console.error('Error line:', e.lineno);
        });
        
        // Wait a bit and check again
        setTimeout(() => {
            console.log('=== SCALABLE TRANSLATOR CHECK (DELAYED) ===');
            console.log('window.scalableTranslator:', window.scalableTranslator);
            if (window.scalableTranslator) {
                console.log('Scalable translator methods:', Object.getOwnPropertyNames(window.scalableTranslator));
                console.log('Current language:', window.scalableTranslator.currentLanguage);
                
                // Test manual translation
                console.log('=== TESTING MANUAL TRANSLATION ===');
                if (window.scalableTranslator.currentLanguage !== 'en') {
                    console.log('Triggering manual translation...');
                    window.scalableTranslator.updatePageContent();
                }
            } else {
                console.error('Scalable translator still not available after delay');
            }
        }, 1000);
    </script>
    <script src="js/languageMenuLoader.min.js"></script>
    <script src="js/recipeLoader.min.js"></script>
    <script src="js/searchRecipes.min.js"></script>
    <script src="js/lazyLoad.min.js"></script>
    <script src="js/navigation.min.js"></script>
    <script src="js/simpleLanguageSwitcher.min.js"></script>
    <script>
        // Debug language menu loader
        setTimeout(() => {
            console.log('=== LANGUAGE MENU DEBUG ===');
            console.log('window.languageMenuLoader:', window.languageMenuLoader);
            console.log('Language menu element:', document.getElementById('language-menu'));
            console.log('Language menu innerHTML:', document.getElementById('language-menu')?.innerHTML);
            
            if (window.languageMenuLoader) {
                console.log('Languages loaded:', window.languageMenuLoader.languages);
                console.log('Current language:', window.languageMenuLoader.currentLanguage);
            }
            
            // Fallback: if menu is still empty, populate it manually
            const languageMenu = document.getElementById('language-menu');
            if (languageMenu && languageMenu.children.length === 0) {
                console.log('Language menu is empty, adding fallback options...');
                const fallbackLanguages = [
                    { code: 'en', native: 'English' },
                    { code: 'fr', native: 'Fran√ßais' },
                    { code: 'es', native: 'Espa√±ol' },
                    { code: 'de', native: 'Deutsch' },
                    { code: 'it', native: 'Italiano' },
                    { code: 'pt', native: 'Portugu√™s' },
                    { code: 'nl', native: 'Nederlands' },
                    { code: 'ru', native: '–†—É—Å—Å–∫–∏–π' },
                    { code: 'zh', native: '‰∏≠Êñá' },
                    { code: 'ja', native: 'Êó•Êú¨Ë™û' },
                    { code: 'ko', native: 'ÌïúÍµ≠Ïñ¥' }
                ];
                
                fallbackLanguages.forEach(lang => {
                    const langOption = document.createElement('div');
                    langOption.className = 'lang-option';
                    langOption.setAttribute('data-lang', lang.code);
                    langOption.textContent = lang.native;
                    languageMenu.appendChild(langOption);
                });
                
                console.log('Fallback language options added');
            }
            
            // Debug computed styles
            if (languageMenu) {
                const computedStyles = window.getComputedStyle(languageMenu);
                console.log('=== LANGUAGE MENU COMPUTED STYLES ===');
                console.log('Background:', computedStyles.background);
                console.log('Background-color:', computedStyles.backgroundColor);
                console.log('Color:', computedStyles.color);
                console.log('Border:', computedStyles.border);
            }
        }, 2000);
    </script>
</body>
</html>